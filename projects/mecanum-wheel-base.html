<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<script type="text/javascript"
			src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
	</script>

	<title>Max's Portfolio</title>
	<link rel="icon" type="image/png" href="/public/images/logo_icon_black_small.png">

	<link rel="stylesheet" href="/public/stylesheets/style.css">

	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

</head>


<body class="bg-fixed bg-no-repeat bg-[center_-180px_top] md:bg-center bg-cover bg-blend-multiply bg-slate-700 h-[100svh] h-screen"
  style="background-image: url('/public/images/jumbotron-bg.jpg')">
  
  <script type="text/javascript">
    (function (window, document, dataLayerName, id) {
      window[dataLayerName] = window[dataLayerName] || [], window[dataLayerName].push({ start: (new Date).getTime(), event: "stg.start" }); var scripts = document.getElementsByTagName('script')[0], tags = document.createElement('script');
      function stgCreateCookie(a, b, c) { var d = ""; if (c) { var e = new Date; e.setTime(e.getTime() + 24 * c * 60 * 60 * 1e3), d = "; expires=" + e.toUTCString(); f = "; SameSite=Strict" } document.cookie = a + "=" + b + d + f + "; path=/" }
      var isStgDebug = (window.location.href.match("stg_debug") || document.cookie.match("stg_debug")) && !window.location.href.match("stg_disable_debug"); stgCreateCookie("stg_debug", isStgDebug ? 1 : "", isStgDebug ? 14 : -1);
      var qP = []; dataLayerName !== "dataLayer" && qP.push("data_layer_name=" + dataLayerName), isStgDebug && qP.push("stg_debug"); var qPString = qP.length > 0 ? ("?" + qP.join("&")) : "";
      tags.async = !0, tags.src = "https://maxpalay.containers.piwik.pro/" + id + ".js" + qPString, scripts.parentNode.insertBefore(tags, scripts);
      !function (a, n, i) { a[n] = a[n] || {}; for (var c = 0; c < i.length; c++)!function (i) { a[n][i] = a[n][i] || {}, a[n][i].api = a[n][i].api || function () { var a = [].slice.call(arguments, 0); "string" == typeof a[0] && window[dataLayerName].push({ event: n + "." + i + ":" + a[0], parameters: [].slice.call(arguments, 1) }) } }(i[c]) }(window, "ppms", ["tm", "cm"]);
    })(window, document, 'dataLayer', '09cea3cf-ceae-4c5f-b845-21cfd41901d3');
  </script>
  
  <div id="wrapper">

    <script>
    // JavaScript to handle scrolling color change
    window.addEventListener('scroll', function() {
      var navbar = document.getElementById('navbar');
      var logo = document.getElementById('logo');
      var navitems = document.getElementById('navbar-items')
      var scrolled = window.scrollY > 50;
      var gh_logo = document.getElementById('gh-logo');

      // Adjust the background color based on the scroll position
      if (scrolled) {
        navbar.classList.add('bg-[#f9f9f9]/[1.0]');
        navbar.classList.remove('bg-[#f9f9f9]/[.1]');
        logo.classList.toggle('default-logo', !scrolled);
        logo.classList.toggle('scrolled-logo', scrolled);
        navitems.classList.toggle('text-white', !scrolled);
        navitems.classList.toggle('text-black', scrolled);
        gh_logo.classList.toggle('default-gh-logo', !scrolled);
        gh_logo.classList.toggle('scrolled-gh-logo', scrolled);
      } else {
        navbar.classList.remove('bg-[#f9f9f9]/[1.0]');
        navbar.classList.add('bg-[#f9f9f9]/[.1]');
        logo.classList.toggle('default-logo', !scrolled);
        logo.classList.toggle('scrolled-logo', scrolled);
        navitems.classList.toggle('text-white', !scrolled);
        navitems.classList.toggle('text-black', scrolled);
        gh_logo.classList.toggle('default-gh-logo', !scrolled);
        gh_logo.classList.toggle('scrolled-gh-logo', scrolled);
      }
    });
</script>

<nav id="navbar" class="bg-[#f9f9f9]/[.1] fixed w-full z-20 top-0 start-0 transition ease-in-out duration-200">
    <div class="max-w-screen-xl flex flex-nowrap items-center justify-between mx-auto p-4 px-10">
        <a id="logo" href="/" class="flex items-center space-x-3 rtl:space-x-reverse h-8 w-3/12 min-w-32 bg-no-repeat bg-contain bg-center default-logo"></a>
        <div class="w-full block w-auto justify-end flex" id="navbar-default">
          <ul id="navbar-items" class="text-white text-xs md:text-sm font-medium subpixel-antialiased flex p-0 mt-0 flex-row md:space-x-8 space-x-2 rtl:space-x-reverse border-0">
            <li>
              <a href="/" class="block bg-blue-700 rounded bg-transparent p-0 dark:hover:text-blue-500">Home</a>
            </li>
            <li>
              <a href="/about/" class="block rounded hover:bg-gray-100 hover:bg-transparent border-0 hover:text-blue-700 p-0 dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white dark:hover:bg-transparent">About</a>
            </li>
            <li>
              <a href="https://www.linkedin.com/in/max-palay/" target="_blank" class="block rounded hover:bg-gray-100 hover:bg-transparent border-0 hover:text-blue-700 p-0 dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white dark:hover:bg-transparent">Contact</a>
            </li>
            <li>
              <a id="gh-logo" href="https://github.com/maxipalay" target="_blank" class="block rounded border-0 p-0 h-full w-12 bg-no-repeat bg-contain bg-center default-gh-logo">
              </a>
            </li>
          </ul>
        </div>
      </div>
  </nav>

    <main class="project backdrop-filter backdrop-blur-md bg-opacity-80 bg-slate-800 min-h-screen" >
	<section id="project-content">
        <div class="py-20 w-9/12 md:w-8/12 mx-auto text-white text-justify text-sm md:text-lg font-normal max-w-screen-xl">
            
            <h2 id="project-date" class="text-right text-sm md:text-md font-normal my-4">February, 2024</h2>
            <h1 class="tracking-tight text-center leading-none relative mb-6 mt-0 text-2xl font-semibold text-slate-50 md:text-3xl lg:text-5xl px-16 lg:px-48">
                <span class="relative z-10">Omnidirectional robot from scratch</span>
            </h1>
            <h1 class="tracking-tight text-center text-sm md:text-lg">
                <span class="relative z-10">Full design, build and control of a mecanum wheel base.</span>
            </h1>
            <div class="h-0.5 w-1/2 my-8 content-center mx-auto relative">
                <div class="absolute inset-0 bg-gradient-to-r from-black/0 via-white/100 to-black/0 rounded-full"></div>
            </div>

            <div class="flex flex-wrap gap-2 font-mono text-white text-sm font-bold rounded-lg justify-center mx-auto">
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">ros2</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">c++</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">control</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">PID</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">feedforward</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">path planning</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">odrive</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">mechatronics</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">CAD</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">mechanical design</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">machining</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">electronics</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">git</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">direct drive</div>
                
                <div class="px-2 py-1 rounded-lg flex items-center justify-center bg-blend-multiply bg-slate-500">raspberry pi</div>
                
              </div>
            
            <iframe src="https://www.youtube-nocookie.com/embed/61nHGPRmb18?si=6qv13THVHyBflKeZ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" class="mx-auto my-8 center w-full rounded-lg max-w-4xl" style="aspect-ratio: 16 / 9;"></iframe>

<p><br /></p>
<div class="text-center font-medium">This project's source code and documentation is available on <a href="https://github.com/maxipalay/minimec-ros2" target="_blank"> <img class="h-8 inline-block relative top-[-2px]" src="../public/logos/github-long.png" /></a></div>

<h1 id="overview">Overview</h1>

<p>This project is about creating a mecanum wheel mobile base end-to-end in only 10 weeks of part-time work. Mechanical design, electronics sourcing, fabrication and software that compose a robot. The driving mechanism provides a robot with holonomic drive: it can move in any direction on the plane.
<br />
<br />
Controls were implemented using ROS2 and C++. It has two control modes: teleoperation and trajectory tracking. For the trajectory tracking, the ROS2 architecture offers services that generate paths. Spline paths with fixed orientation, spline paths with point of interest (robot faces a point at all times), and circular paths with point of interest. More functionality can be incrementally added.
<br />
<br />
The system was designed for ease of manufacturability due to the short timeframe to complete the project. Chassis is comprised of widely available 2020 aluminum extrusion profiles. Custom parts are mostly machined out of sheet metal. Wheels are powered by BLDC motors in a direct drive configuration using Odrive robotics hardware.
<br />
<br />
This post outlines several aspects of the project:
<br /></p>
<div class="w-11/12 mx-auto">
<li>ROS Architecture</li>

<li>Path generation</li>

<li>Control</li>

<li>Mechanical design &amp; build</li>

<li>Electronics</li>

<li>Future Work</li>
</div>

<h1 id="ros-architecture">ROS Architecture</h1>

<p>The software running on this robot is based on ROS2 Iron, C++ and Python. All nodes except for the LEDs control node were implemented in C++. Image 1 depicts an overview of the ROS nodes that compose the system. The software was designed considering hardware abstraction, so anyone could potentially swap the <code class="language-plaintext highlighter-rouge">minimec_driver</code> and <code class="language-plaintext highlighter-rouge">odrive_can</code> nodes with others that interface with their own hardware and everything should work. The driver node exposes information provided by the odrive in a more standardized ROS2 format following conventions (joint states, cmd_vel, etc).
<br />
<br />
<img src="../public/images/projects/mecanum-base/ros_architecture.png" class="mx-auto my-8 center w-2/3 rounded-lg max-w-4xl" /></p>
<div class="italic text-center font-xs w-5/6 mx-auto center">Image 1: High level ROS2 architecture. Boxes represent nodes, arrows represent information exchange. This diagram is not exhaustive.</div>
<p><br />
<br />
In teleoperation mode, the nodes <code class="language-plaintext highlighter-rouge">path_generator</code> and <code class="language-plaintext highlighter-rouge">trajectory_tracking</code> are not necessary, and the input velocity commands are provided by the user. In this case, the odometry feedback is not used, except for visualization purposes.</p>

<h1 id="path-generation">Path generation</h1>

<p><img src="../public/images/projects/mecanum-base/planned_paths.png" class="mx-auto my-8 center w-2/3 rounded-lg max-w-4xl" /></p>
<div class="italic text-center font-xs w-5/6 mx-auto center">Image 2: Generated paths: spline with fixed orientation, spline facing a point, circular path (left to right). Control points marked in red, heading point marked in blue.</div>
<p><br />
<br />
A ROS2 node offers services that generate different plans/trajectories. The three available modes are: 
<br />
<br /></p>
<div class="w-11/12 mx-auto">
<li>Spline from control points with fixed heading: a spline is generated from control points specified by the user. The robot moves along the generated spline maintaining a fixed orientation with respect to the world. The heading angle can be specified by the user.</li>
<br />
<li>Spline from control points with point of interest: the robot moves along the generated spline, while keeping its front facing a specified point.</li>
<br />
<li>Circular path facing the center: the user can specify a center and radius, and the robot moves along the circle facing the center at all times.</li>
</div>
<p><br />
<br />
The circular path generation was implemented from scratch, and required basic geometry calculations. The splines are generated using the <a href="https://github.com/msteinbeck/tinyspline">TinySpline library</a>. Basically, the user provides a set of control points, and a spline that fits those is generated. Then, the algorithm runs through the spline (at a user set precision), and generates a path only taking the <code class="language-plaintext highlighter-rouge">(x,y)</code> position from the spline. The orientation is independently added.</p>

<h1 id="control">Control</h1>

<p>The control system commands wheel speeds to track desired trajectories. The motor drivers are configured to receive speed commands and provide position feedback form their encoders to the implemented odometry.
<br />
<br />
<img src="../public/images/projects/mecanum-base/control.png" class="mx-auto my-8 center w-2/3 rounded-lg max-w-4xl" /></p>
<div class="italic text-center font-xs w-5/6 mx-auto center">Image 3: Schematic of the control algorithm.</div>
<p><br />
<br />
The used algorithm is a feedforward + PI controller. Using the reference trajectory, a feedforward body twist is calculated. The error between the current expected configuration and the odometry feedback is used for the PI control. A representation of the control system is shown in Image 3.
<br />
<br />
<img src="../public/images/projects/mecanum-base/trajectory_tracking.jpg" class="mx-auto my-8 center w-2/3 rounded-lg max-w-4xl" /></p>
<div class="italic text-center font-xs w-5/6 mx-auto center">Image 4: Visualization of robot tracking reference trajectory. Reference trajectory shown in green, odometry estimate shown as red arrows.</div>
<p><br />
<br />
A visualization of the robot tracking the reference trajectory is shown in Image 4. Note this visualization is not a simulation, but a real time feedback of the robot’s estimation from its odometry, overlayed with the reference trajectory.</p>

<h1 id="mechanical-design--build">Mechanical design &amp; build</h1>

<p><img src="../public/images/projects/mecanum-base/render.png" class="mx-auto my-8 center w-2/3 rounded-lg max-w-4xl" /></p>
<div class="italic text-center font-xs w-5/6 mx-auto center">Image 5: Render of the mechanical design.</div>
<p><br />
<br />
The system was designed for fast fabrication and assembly. The actuators are a custom design with an attempt at making them modular. Few components had to be machined in house. A render of the final design is shown on Image 5.
<br />
<br />
Something that makes this design special is the direct drive mechanism, no reduction in between the motors and wheels. This is not usual in mecanum wheel vehicles, as they usually operate with different types of reductions (belt drives, chain &amp; sprocket, planetary gearboxes). Advantages of a direct drive mechanism include reduced noise, efficiency, simple design and backdrivability (especially important for collaborative robotics). Also, the backdrivability could allow for current regeneration when braking, although this is not implemented at the moment.
<br />
<br />
A timelapse of the assembly follows. The total assembly time is estimated to be around 10-15 hours.
<br />
<br /></p>
<iframe src="https://www.youtube-nocookie.com/embed/oV_v6JY8yzM?si=L2RrMLD51yuXvuj-" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" class="mx-auto my-8 center w-full rounded-lg max-w-4xl" style="aspect-ratio: 16 / 9;"></iframe>

<h1 id="electronics">Electronics</h1>

<p>The onboard computer is a Raspberry Pi 4. It communicates with the Odrive S1 motor controllers through a USB-CAN adapter. The outrunner brushless motors and encoders were purchased from Odrive. The system uses a circuit breaker as a main switch. A Kar-Tech wireless E-Stop operates a relay that cuts power to the motors (but not to the Raspberry Pi). The used battery provides 22.2V nominal voltage. An isolated step-down is used to power the Raspberry Pi.</p>

<h2 id="leds">LEDs</h2>

<p>A strip of 142 neopixel LEDs is mounted under the bottom panel of the robot. This was a final addition to the project, as it is more aesthetic than functional. Nonetheless, the leds are driven by a ROS2 node and they provide visual feedback of robot movement. While the robot is stationary, a chase of rainbow colors runs through the LEDs. When the robot has linear velocity, the leds light up on the direction of the velocity. When there is only angular velocity, the leds perform a chase in the direction of rotation. These features can be seen in the main video.</p>

<h1 id="future-work">Future work</h1>

<p>While this project’s result is a fully operational robot, there is still a lot to do. The small timeframe to work on the project meant taking shortcuts and simplifications for the sake of time. A non-exhaustive list of features to be added/reviewed follows:</p>
<div class="w-11/12 mx-auto">
<br />
<li>Acceleration control: currently none of the controls take acceleration into consideration. Adding acceleration constraints to the control algorithms will improve the performance of the robot.</li>
<br />
<li>More path planning modes: adding more trajectory generation options. Splines and circles don't cover all possible use cases. Ultimately, the planning modes are highly dependent on application.</li>
<br />
<li>Expose more path generating parameters to the user: parameters of the spline approximation are mostly hardcoded in the node. Exposing these to the service calls would make for a more customizable solution.</li>
<br />
<li>Localization: having the robot localize itself on the environment can help better track trajectories. This is especially important because the mecanum wheel base is very sensitive to uneven ground, which can constantly cause slipping.</li>
<br />
<li>Brakes: backdrivability is great. It can improve the safety and collaborative aspect of the minimec. Nonetheless, when the E-STOP is activated, the inertia keeps the robot going. Having power-off brakes would make this safer.</li>
<br />
<li>Decouple ROS nodes from trajectory tracking code.</li>
</div>

<h1 id="attribution">Attribution</h1>

<p>This project makes use of the <a href="https://github.com/msteinbeck/tinyspline">TinySpline</a> library for generating the spline from reference points.
<br />
<br />
The kinematics and trajectory tracking are heavily based on <a href="https://hades.mech.northwestern.edu/index.php/Modern_Robotics">Lynch, Park - Modern Robotics</a> book and the corresponding <a href="https://github.com/NxRLab/ModernRobotics">Modern Robotics python library</a></p>

        </div>
		

	</section>

</main>


    

<footer class="rounded-lg shadow bg-[#f9f9f9]/[1.0]">
    <div class="w-full max-w-screen-xl mx-auto p-4">
        <div class="sm:flex sm:items-center sm:justify-between">
            <a class="flex items-center mb-4 sm:mb-0 space-x-3 rtl:space-x-reverse">
                <img src="/public/images/logo_acronym_small_black.png" class="h-6" alt="Logo" />
            </a>
            <ul class="flex flex-wrap items-center mb-6 text-sm font-medium text-gray-500 sm:mb-0 dark:text-gray-400">
                <li>
                    <a href="/about/" class="hover:underline me-4 md:me-6">About</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/maximiliano-palay/" target="_blank" class="hover:underline">Contact</a>
                </li>
            </ul>
        </div>
        <hr class="my-6 border-gray-200 sm:mx-auto dark:border-gray-700 lg:my-4" />
        <span class="block text-sm text-gray-500 sm:text-center dark:text-gray-400">2024 - Maximiliano Palay</span>
    </div>
</footer>




  </div>

  <div id="popup" class="fixed bottom-0 right-0 z-50 p-2 max-w-xl">
    <div class="relative">
      <div class="relative rounded-lg shadow bg-slate-800">
        <!-- Modal header -->
        <div class="flex items-center justify-between p-2">
          <p class="text-sm text-gray-500 dark:text-gray-400 px-4">
            This site is currently under development. Feedback is welcome!
          </p>
          <button type="button" id="hide-popup"
            class="text-slate-400 rounded-lg text-sm w-6 h-6 ms-auto inline-flex justify-center items-center bg-slate-700 hover:bg-slate-600 hover:text-white">
            <svg class="w-2 h-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('hide-popup').addEventListener('click', function () {
      var popup = document.getElementById('popup');
      popup.classList.toggle('hidden');
    });
  </script>

</body>

</html>